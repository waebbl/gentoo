From: Bernd Waibel <waebbl-gentoo@posteo.net>
Date: Thu, 24 Jun 2021 18:27:47 +0200
Subject: [PATCH 1/2] changes needed for proper slotting

Signed-off-by: Bernd Waibel <waebbl-gentoo@posteo.net>
---
 OpenEXR-2.pc.in              |  4 ++--
 config/CMakeLists.txt      |  8 ++++----
 config/LibraryDefine.cmake | 12 ++++++------
 3 files changed, 12 insertions(+), 12 deletions(-)

diff --git a/OpenEXR-2.pc.in b/OpenEXR-2.pc.in
index cf72f88..a995bd8 100644
--- a/OpenEXR-2.pc.in
+++ b/OpenEXR-2.pc.in
@@ -5,9 +5,9 @@
 
 prefix=@prefix@
 exec_prefix=@exec_prefix@
-libdir=@libdir@
+libdir=@libdir@/@OPENEXR_OUTPUT_SUBDIR@
 includedir=@includedir@
-OpenEXR_includedir=@includedir@/OpenEXR
+OpenEXR_includedir=@includedir@/@OPENEXR_OUTPUT_SUBDIR@
 libsuffix=@LIB_SUFFIX_DASH@
 
 Name: OpenEXR
diff --git a/config/CMakeLists.txt b/config/CMakeLists.txt
index 039190c..6791392 100644
--- a/config/CMakeLists.txt
+++ b/config/CMakeLists.txt
@@ -94,7 +94,7 @@ if(OPENEXR_INSTALL_PKG_CONFIG)
         DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig
     )
   endfunction()
-  openexr_pkg_config_help(../OpenEXR.pc.in)
+  openexr_pkg_config_help(../OpenEXR-${OPENEXR_VERSION_MAJOR}.pc.in)
 endif()
 
 # The main export of the configuration - This is the
@@ -103,7 +103,7 @@ endif()
 include(CMakePackageConfigHelpers)
 configure_package_config_file(OpenEXRConfig.cmake.in
   ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}Config.cmake
-  INSTALL_DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
+  INSTALL_DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}-${OPENEXR_VERSION_MAJOR}
 )
 write_basic_package_version_file("${PROJECT_NAME}ConfigVersion.cmake"
   VERSION ${OPENEXR_VERSION}
@@ -111,10 +111,10 @@ write_basic_package_version_file("${PROJECT_NAME}ConfigVersion.cmake"
 )
 install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}Config.cmake
               ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}ConfigVersion.cmake
-  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
+  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}-${OPENEXR_VERSION_MAJOR}
 )
 install(EXPORT ${PROJECT_NAME}
-  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
+  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}-${OPENEXR_VERSION_MAJOR}
   FILE ${PROJECT_NAME}Targets.cmake
   NAMESPACE ${PROJECT_NAME}::
   EXPORT_LINK_INTERFACE_LIBRARIES
diff --git a/config/LibraryDefine.cmake b/config/LibraryDefine.cmake
index 0db0297..e419293 100644
--- a/config/LibraryDefine.cmake
+++ b/config/LibraryDefine.cmake
@@ -84,8 +84,8 @@ function(OPENEXR_DEFINE_LIBRARY libname)
   install(TARGETS ${libname}
     EXPORT ${PROJECT_NAME}
     RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
-    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}/${OPENEXR_OUTPUT_SUBDIR}
+    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}/${OPENEXR_OUTPUT_SUBDIR}
     INCLUDES DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
     PUBLIC_HEADER
       DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${OPENEXR_OUTPUT_SUBDIR}
@@ -94,8 +94,8 @@ function(OPENEXR_DEFINE_LIBRARY libname)
     string(TOUPPER "${CMAKE_BUILD_TYPE}" uppercase_CMAKE_BUILD_TYPE)
     set(verlibname ${CMAKE_SHARED_LIBRARY_PREFIX}${libname}${OPENEXR_LIB_SUFFIX}${CMAKE_${uppercase_CMAKE_BUILD_TYPE}_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX})
     set(baselibname ${CMAKE_SHARED_LIBRARY_PREFIX}${libname}${CMAKE_${uppercase_CMAKE_BUILD_TYPE}_POSTFIX}${CMAKE_SHARED_LIBRARY_SUFFIX})
-    install(CODE "execute_process(COMMAND ${CMAKE_COMMAND} -E chdir \"\$ENV\{DESTDIR\}${CMAKE_INSTALL_FULL_LIBDIR}\" ${CMAKE_COMMAND} -E create_symlink ${verlibname} ${baselibname})")
-    install(CODE "message(\"-- Creating symlink in ${CMAKE_INSTALL_FULL_DIR} ${baselibname} -> ${verlibname}\")")
+    install(CODE "execute_process(COMMAND ${CMAKE_COMMAND} -E chdir \"\$ENV\{DESTDIR\}${CMAKE_INSTALL_FULL_LIBDIR}/${OPENEXR_OUTPUT_SUBDIR}\" ${CMAKE_COMMAND} -E create_symlink ${verlibname} ${baselibname})")
+    install(CODE "message(\"-- Creating symlink in ${CMAKE_INSTALL_FULL_DIR}/${OPENEXR_OUTPUT_SUBDIR} ${baselibname} -> ${verlibname}\")")
     set(verlibname)
     set(baselibname)
   endif()
@@ -133,8 +133,8 @@ function(OPENEXR_DEFINE_LIBRARY libname)
     install(TARGETS ${libname}_static
       EXPORT ${PROJECT_NAME}
       RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-      LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
-      ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+      LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}/${OPENEXR_OUTPUT_SUBDIR}
+      ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}/${OPENEXR_OUTPUT_SUBDIR}
       INCLUDES DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
     )
   endif()
-- 
2.32.0

