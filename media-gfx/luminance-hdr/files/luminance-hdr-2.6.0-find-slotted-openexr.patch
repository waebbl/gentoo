From 8421bba19e70a156902f4482ea5f1a1ed397984f Mon Sep 17 00:00:00 2001
From: Bernd Waibel <waebbl-gentoo@posteo.net>
Date: Sat, 26 Jun 2021 23:16:34 +0200
Subject: [PATCH] find slotted openexr

Signed-off-by: Bernd Waibel <waebbl-gentoo@posteo.net>
---
 CMakeLists.txt                        | 4 ++--
 build_files/Modules/FindOpenEXR.cmake | 7 ++++---
 2 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 8657048..4179207 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -188,8 +188,8 @@ INCLUDE_DIRECTORIES(${TIFF_INCLUDE_DIR})
 FIND_PACKAGE(PNG REQUIRED)
 INCLUDE_DIRECTORIES(${PNG_INCLUDE_DIR})
 
-FIND_PACKAGE(OpenEXR REQUIRED)
-INCLUDE_DIRECTORIES(${OPENEXR_INCLUDE_DIR} "${OPENEXR_INCLUDE_DIR}/OpenEXR")
+FIND_PACKAGE(OpenEXR 2.5 REQUIRED)
+INCLUDE_DIRECTORIES(${OPENEXR_INCLUDE_DIR} "${OPENEXR_INCLUDE_DIR}/OpenEXR-2")
 
 FIND_PACKAGE(GSL REQUIRED)
 INCLUDE_DIRECTORIES(${GSL_INCLUDE_DIR} ${GSLCBLAS_INCLUDE_DIR})
diff --git a/build_files/Modules/FindOpenEXR.cmake b/build_files/Modules/FindOpenEXR.cmake
index b60658e..543c51c 100644
--- a/build_files/Modules/FindOpenEXR.cmake
+++ b/build_files/Modules/FindOpenEXR.cmake
@@ -58,6 +58,7 @@ endif ()
 
 SET(_openexr_SEARCH_DIRS
   ${OPENEXR_ROOT_DIR}
+  /usr
   /usr/local
   /sw # Fink
   /opt/local # DarwinPorts
@@ -66,7 +67,7 @@ SET(_openexr_SEARCH_DIRS
 
 FIND_PATH(OPENEXR_INCLUDE_DIR
   NAMES
-    OpenEXR/ImfXdr.h
+    OpenEXR/ImfXdr.h OpenEXR-2/ImfXdr.h
   HINTS
     ${_openexr_SEARCH_DIRS}
   PATH_SUFFIXES
@@ -83,7 +84,7 @@ FOREACH(COMPONENT ${_openexr_FIND_COMPONENTS})
     HINTS
       ${_openexr_SEARCH_DIRS}
     PATH_SUFFIXES
-      lib64 lib
+      lib64 lib lib64/OpenEXR-2 lib/OpenEXR-2
     )
   LIST(APPEND _openexr_LIBRARIES "${OPENEXR_${UPPERCOMPONENT}_LIBRARY}")
 ENDFOREACH()
@@ -97,7 +98,7 @@ FIND_PACKAGE_HANDLE_STANDARD_ARGS(OpenEXR  DEFAULT_MSG
 IF(OPENEXR_FOUND)
   SET(OPENEXR_LIBRARIES ${_openexr_LIBRARIES})
   # Both include paths are needed because of dummy OSL headers mixing #include <OpenEXR/foo.h> and #include <foo.h> :(
-  SET(OPENEXR_INCLUDE_DIRS ${OPENEXR_INCLUDE_DIR} ${OPENEXR_INCLUDE_DIR}/OpenEXR)
+  SET(OPENEXR_INCLUDE_DIRS ${OPENEXR_INCLUDE_DIR} ${OPENEXR_INCLUDE_DIR}/OpenEXR-2)
   message(STATUS "OpenEXR found")
 ENDIF()
 
-- 
2.32.0

